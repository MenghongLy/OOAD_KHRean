{% extends "base.html" %}

{% block title %}Student Details{% endblock %}

{% block sidebar_subtitle %}Teacher Portal{% endblock %}

{% block sidebar_menu %}
<li>
    <a href="{{ url_for('teacher_bp.dashboard') }}">
        <i class="fas fa-home"></i>
        Dashboard
    </a>
</li>
<li>
    <a href="{{ url_for('teacher_bp.students') }}">
        <i class="fas fa-users"></i>
        My Students
    </a>
</li>
<li>
    <a href="{{ url_for('teacher_bp.classes') }}">
        <i class="fas fa-chalkboard"></i>
        Classes
    </a>
</li>
<li>
    <a href="{{ url_for('teacher_bp.assignments') }}">
        <i class="fas fa-tasks"></i>
        Assignments
    </a>
</li>
<li>
    <a href="{{ url_for('teacher_bp.grades') }}">
        <i class="fas fa-chart-line"></i>
        Grades
    </a>
</li>
<li>
    <a href="{{ url_for('teacher_bp.profile') }}">
        <i class="fas fa-user-edit"></i>
        Edit Profile
    </a>
</li>
<li style="margin-top: 2rem;">
    <a href="{{ url_for('auth_bp.logout') }}">
        <i class="fas fa-sign-out-alt"></i>
        Logout
    </a>
</li>
{% endblock %}

{% block search_placeholder %}Search...{% endblock %}

{% block user_avatar %}T{% endblock %}
{% block user_name %}Teacher{% endblock %}
{% block user_id %}Teacher{% endblock %}

{% block content %}
<!-- Back Button -->
<div style="margin-bottom: 1.5rem;">
    <a href="{{ url_for('teacher_bp.students') }}" class="btn-custom btn-outline-custom">
        <i class="fas fa-arrow-left"></i> Back to Students
    </a>
</div>

<!-- Student Header -->
<div class="content-card" style="margin-bottom: 2rem;">
    <div style="display: flex; align-items: center; gap: 2rem;">
        <!-- Student Avatar -->
        <div style="width: 100px; height: 100px; border-radius: 50%; 
                    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); 
                    display: flex; align-items: center; justify-content: center; color: white; 
                    font-size: 2.5rem; font-weight: 700; flex-shrink: 0;">
            {{ student.first_name[0]|upper }}{{ student.last_name[0]|upper }}
        </div>

        <!-- Student Info -->
        <div style="flex: 1;">
            <h2 style="font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">
                {{ student.first_name }} {{ student.last_name }}
            </h2>
            <p style="color: #6b7280; margin: 0 0 1rem 0;">
                <i class="fas fa-envelope"></i> {{ student.email }}
            </p>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <span class="badge badge-submitted" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                    <i class="fas fa-id-card"></i> Student ID: #{{ student.id }}
                </span>
                <span class="badge badge-graded" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                    <i class="fas fa-check-circle"></i> Active
                </span>
            </div>
        </div>

        <!-- Actions -->
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
            <button class="btn-custom btn-primary-custom" onclick="sendMessage()">
                <i class="fas fa-envelope"></i> Send Message
            </button>
            <button class="btn-custom btn-outline-custom" onclick="exportReport()">
                <i class="fas fa-download"></i> Export Report
            </button>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="stats-grid" style="margin-bottom: 2rem;">
    <div class="stat-card primary">
        <div class="stat-icon"><i class="fas fa-chalkboard"></i></div>
        <div class="stat-value">{{ student.classes|length }}</div>
        <div class="stat-label">Enrolled Classes</div>
    </div>
    <div class="stat-card success">
        <div class="stat-icon"><i class="fas fa-clipboard-check"></i></div>
        <div class="stat-value">{{ student.assignments|length }}</div>
        <div class="stat-label">Total Assignments</div>
    </div>
    <div class="stat-card info">
        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
        <div class="stat-value">{{ student.assignments|selectattr('status', 'equalto', 'Graded')|list|length }}</div>
        <div class="stat-label">Graded</div>
    </div>
    <div class="stat-card warning">
        <div class="stat-icon"><i class="fas fa-percentage"></i></div>
        <div class="stat-value">
            {% set graded = student.assignments|selectattr('grade', 'ne', 'Not graded')|list %}
            {% if graded|length > 0 %}
            {% set grades = graded|map(attribute='grade')|map('int')|list %}
            {{ (grades|sum / grades|length)|round(1) }}%
            {% else %}
            N/A
            {% endif %}
        </div>
        <div class="stat-label">Average Grade</div>
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 2rem;">
    <!-- Enrolled Classes -->
    <div class="content-card">
        <div class="card-header">
            <h4><i class="fas fa-chalkboard"></i> Enrolled Classes</h4>
        </div>

        {% if student.classes %}
        {% for class in student.classes %}
        <div style="padding: 1rem; background: var(--light-bg); border-radius: 10px; margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <h5 style="margin: 0 0 0.5rem 0; font-weight: 600;">{{ class.name }}</h5>
                    <p style="margin: 0; color: #6b7280; font-size: 0.9rem;">{{ class.description }}</p>
                </div>
                <span class="badge badge-submitted">Active</span>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="empty-state" style="padding: 2rem;">
            <i class="fas fa-chalkboard"></i>
            <h5>No classes enrolled</h5>
            <p>This student is not enrolled in any of your classes yet</p>
        </div>
        {% endif %}
    </div>

    <!-- Recent Assignments -->
    <div class="content-card">
        <div class="card-header">
            <h4><i class="fas fa-tasks"></i> Assignment History</h4>
        </div>

        {% if student.assignments %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Assignment</th>
                        <th>Class</th>
                        <th>Grade</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for assignment in student.assignments %}
                    <tr>
                        <td>
                            <strong>{{ assignment.title }}</strong>
                            <br>
                            <small style="color: #6b7280;">{{ assignment.submission_date }}</small>
                        </td>
                        <td>
                            <span class="badge badge-submitted" style="font-size: 0.8rem;">
                                {{ assignment.class_name }}
                            </span>
                        </td>
                        <td>
                            {% if assignment.grade != 'Not graded' %}
                            <strong style="
                                    {% if assignment.grade|int >= 90 %}color: var(--success-color);
                                    {% elif assignment.grade|int >= 80 %}color: var(--info-color);
                                    {% elif assignment.grade|int >= 70 %}color: var(--warning-color);
                                    {% else %}color: var(--danger-color);
                                    {% endif %}">
                                {{ assignment.grade }}%
                            </strong>
                            {% else %}
                            <span style="color: #9ca3af;">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if assignment.status == 'Graded' %}
                            <span class="badge badge-graded">{{ assignment.status }}</span>
                            {% else %}
                            <span class="badge badge-pending">{{ assignment.status }}</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state" style="padding: 2rem;">
            <i class="fas fa-tasks"></i>
            <h5>No assignments yet</h5>
            <p>Student hasn't submitted any assignments yet</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Performance Chart -->
<div class="content-card" style="margin-top: 2rem;">
    <div class="card-header">
        <h4><i class="fas fa-chart-line"></i> Performance Overview</h4>
    </div>

    <div style="text-align: center; padding: 3rem;">
        <i class="fas fa-chart-bar" style="font-size: 4rem; color: #d1d5db; margin-bottom: 1rem;"></i>
        <h5 style="color: #6b7280;">Performance Chart</h5>
        <p style="color: #9ca3af;">Detailed performance analytics will be available soon</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function sendMessage() {
        alert('Message functionality will be implemented soon!');
    }

    function exportReport() {
        alert('Export report functionality will be implemented soon!');
    }
</script>
{% endblock %}