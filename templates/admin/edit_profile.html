{% extends "base.html" %}

{% block title %}Edit Profile{% endblock %}

{% block sidebar_subtitle %}Admin Portal{% endblock %}

{% block sidebar_menu %}
<li>
    <a href="{{ url_for('admin_bp.dashboard') }}">
        <i class="fas fa-home"></i>
        Dashboard
    </a>
</li>
<li>
    <a href="{{ url_for('admin_bp.manage_users') }}">
        <i class="fas fa-users-cog"></i>
        Manage Users
    </a>
</li>
<li>
    <a href="{{ url_for('admin_bp.manage_teachers') }}">
        <i class="fas fa-chalkboard-teacher"></i>
        Manage Teachers
    </a>
</li>
<li>
    <a href="{{ url_for('admin_bp.manage_students') }}">
        <i class="fas fa-user-graduate"></i>
        Manage Students
    </a>
</li>
<li>
    <a href="{{ url_for('admin_bp.manage_assignments') }}">
        <i class="fas fa-tasks"></i>
        Manage Assignments
    </a>
</li>
<li>
    <a href="{{ url_for('admin_bp.manage_roles') }}">
        <i class="fas fa-user-shield"></i>
        Manage Roles
    </a>
</li>
<li>
    <a href="{{ url_for('admin_bp.edit_profile') }}" class="active">
        <i class="fas fa-user-edit"></i>
        Edit Profile
    </a>
</li>
<li style="margin-top: 2rem;">
    <a href="{{ url_for('auth_bp.logout') }}">
        <i class="fas fa-sign-out-alt"></i>
        Logout
    </a>
</li>
{% endblock %}

{% block search_placeholder %}Search settings...{% endblock %}

{% block content %}
<!-- Page Header -->
<div style="margin-bottom: 2rem;">
    <h2 style="font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">Edit Profile</h2>
    <p style="color: #6b7280; margin: 0;">Update your personal information and account settings</p>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert alert-{{ category }} alert-dismissible fade show" role="alert"
    style="border-radius: 12px; margin-bottom: 1.5rem;">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endfor %}
{% endif %}
{% endwith %}

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
    <!-- Profile Information -->
    <div class="content-card">
        <div class="card-header">
            <h4><i class="fas fa-user"></i> Profile Information</h4>
        </div>
        <form method="POST" action="{{ url_for('admin_bp.edit_profile') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <!-- Avatar Section -->
            <div
                style="text-align: center; margin-bottom: 2rem; padding-bottom: 2rem; border-bottom: 2px solid var(--light-bg);">
                <div
                    style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); display: inline-flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 2.5rem; margin-bottom: 1rem;">
                    {{ admin.first_name[0] if admin.first_name else 'A' }}{{ admin.last_name[0] if admin.last_name else
                    'D' }}
                </div>
                <div>
                    <button type="button" class="btn-custom btn-outline-custom" style="font-size: 0.9rem;">
                        <i class="fas fa-camera"></i> Change Avatar
                    </button>
                </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #1f2937;">First
                    Name</label>
                <input type="text" name="first_name" value="{{ admin.first_name if admin.first_name else '' }}"
                    class="form-control" style="border-radius: 10px; border: 1px solid #e5e7eb; padding: 0.75rem;"
                    required>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #1f2937;">Last
                    Name</label>
                <input type="text" name="last_name" value="{{ admin.last_name if admin.last_name else '' }}"
                    class="form-control" style="border-radius: 10px; border: 1px solid #e5e7eb; padding: 0.75rem;"
                    required>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #1f2937;">Email
                    Address</label>
                <input type="email" name="email" value="{{ admin.email if admin.email else '' }}" class="form-control"
                    style="border-radius: 10px; border: 1px solid #e5e7eb; padding: 0.75rem;" required>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #1f2937;">Phone
                    Number</label>
                <input type="tel" name="phone" value="{{ admin.phone if admin.phone else '' }}" class="form-control"
                    style="border-radius: 10px; border: 1px solid #e5e7eb; padding: 0.75rem;">
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #1f2937;">Bio</label>
                <textarea name="bio" rows="4" class="form-control"
                    style="border-radius: 10px; border: 1px solid #e5e7eb; padding: 0.75rem;">{{ admin.bio if admin.bio else '' }}</textarea>
            </div>

            <button type="submit" class="btn-custom btn-primary-custom" style="width: 100%;">
                <i class="fas fa-save"></i> Save Changes
            </button>
        </form>
    </div>

    <!-- Security Settings -->
    <div class="content-card">
        <div class="card-header">
            <h4><i class="fas fa-lock"></i> Security Settings</h4>
        </div>
        <form method="POST" action="{{ url_for('admin_bp.edit_profile') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="form_type" value="security">

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #1f2937;">Current
                    Password</label>
                <input type="password" name="current_password" class="form-control"
                    style="border-radius: 10px; border: 1px solid #e5e7eb; padding: 0.75rem;" required>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #1f2937;">New
                    Password</label>
                <input type="password" name="new_password" class="form-control"
                    style="border-radius: 10px; border: 1px solid #e5e7eb; padding: 0.75rem;" required>
                <small style="color: #6b7280; font-size: 0.85rem;">Must be at least 8 characters long</small>
            </div>

            <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #1f2937;">Confirm New
                    Password</label>
                <input type="password" name="confirm_password" class="form-control"
                    style="border-radius: 10px; border: 1px solid #e5e7eb; padding: 0.75rem;" required>
            </div>

            <button type="submit" class="btn-custom btn-primary-custom" style="width: 100%;">
                <i class="fas fa-key"></i> Update Password
            </button>
        </form>

        <!-- Two-Factor Authentication -->
        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--light-bg);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div>
                    <h5 style="margin: 0; font-weight: 600; color: #1f2937;">Two-Factor Authentication</h5>
                    <p style="margin: 0.25rem 0 0; font-size: 0.9rem; color: #6b7280;">Add an extra layer of security
                    </p>
                </div>
                <label class="switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" style="opacity: 0; width: 0; height: 0;">
                    <span
                        style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; border-radius: 24px; transition: .4s;"></span>
                </label>
            </div>
        </div>
    </div>
</div>

<!-- Account Statistics -->
<div class="content-card" style="margin-top: 2rem;">
    <div class="card-header">
        <h4><i class="fas fa-chart-line"></i> Account Statistics</h4>
    </div>
    <div
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; padding-top: 1rem;">
        <div>
            <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem;">Account Created</div>
            <div style="font-size: 1.25rem; font-weight: 600; color: #1f2937;">{{ admin.created_at.strftime('%b %d, %Y')
                if admin.created_at else 'N/A' }}</div>
        </div>
        <div>
            <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem;">Last Login</div>
            <div style="font-size: 1.25rem; font-weight: 600; color: #1f2937;">{{ admin.last_login if admin.last_login
                else 'First time' }}</div>
        </div>
        <div>
            <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem;">Total Sessions</div>
            <div style="font-size: 1.25rem; font-weight: 600; color: #1f2937;">0</div>
        </div>
        <div>
            <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem;">Actions Performed</div>
            <div style="font-size: 1.25rem; font-weight: 600; color: #1f2937;">0</div>
        </div>
    </div>
</div>

<!-- Danger Zone -->
<div class="content-card" style="margin-top: 2rem; border-left: 4px solid var(--danger-color);">
    <div class="card-header">
        <h4><i class="fas fa-exclamation-triangle"></i> Danger Zone</h4>
    </div>
    <div>
        <div
            style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #fee2e2; border-radius: 10px;">
            <div>
                <h5 style="margin: 0; font-weight: 600; color: var(--danger-color);">Delete Account</h5>
                <p style="margin: 0.25rem 0 0; font-size: 0.9rem; color: #991b1b;">Once you delete your account, there
                    is no going back. Please be certain.</p>
            </div>
            <button class="btn-custom" style="background: var(--danger-color); color: white;"
                onclick="confirmDeleteAccount()">
                <i class="fas fa-trash"></i> Delete Account
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function confirmDeleteAccount() {
        if (confirm('Are you absolutely sure you want to delete your account? This action cannot be undone.')) {
            if (confirm('Final confirmation: Delete account permanently?')) {
                // Add account deletion logic here
                alert('Account deletion initiated');
            }
        }
    }

    // Toggle switch styling
    document.querySelectorAll('.switch input').forEach(checkbox => {
        checkbox.addEventListener('change', function () {
            const slider = this.nextElementSibling;
            if (this.checked) {
                slider.style.backgroundColor = 'var(--primary-color)';
            } else {
                slider.style.backgroundColor = '#ccc';
            }
        });
    });
</script>
{% endblock %}

{% block extra_css %}
<style>
    .switch input:checked+span:before {
        transform: translateX(26px);
    }

    .switch span:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        border-radius: 50%;
        transition: .4s;
    }
</style>
{% endblock %}